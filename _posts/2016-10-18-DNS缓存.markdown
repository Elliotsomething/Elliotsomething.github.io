---
layout:     post
title:      "iOS 之 DNS的缓存"
subtitle:   "DNS Cache"
date:       2016-10-18
author:     "Elliot"
header-img: "img/post-bg-ios9-web.jpg"
catalog:    true
tags:
    - iOS
    - DNS Cache
---

**版权声明：本文为博主原创文章，未经博主允许不得转载**

### DNS缓存

DNS的缓存策略，tcp连接优化处理

看了一篇DNS缓存的博客，想到我们自己的项目中也有和这个机制，于是整理了一下

[大神博客](http://mrpeak.cn/ios/2016/01/22/dnsmapping)的核心思路：

- 降低DNS请求带来的延迟
- 客户端app的请求第一步都是DNS解析，直接跳过DNS解析这一步，能提升网络性能
- 预防DNS劫持
- DNS劫持指的是改变DNS请求的返回结果，将目的ip指向另一个地址。客户端自己做DNS与ip地址的映射就跨过了解析，让劫持者无从下手。
- 服务器动态部署(这个如果是直接连IP的话，好像用不到)

**设计自己的DNS映射机制**

1. 一个打包到app包里面的默认映射文件，这样可以避免第一次去服务器取配置文件带来的延迟。
2. 有一个定时器能每隔一段时间从服务器获取最新的映射，并覆盖本地。
3. 每次取到最新的映射文件之后，同时把上一次的映射文件保存起来作为替补，一旦出现线上配置失误不至于导致请求无法处理。
4. 如果映射文件不能处理域名，要能回滚使用默认的DNS解析服务。
5. 如果一个映射过后的ip持续导致请求失败，应该能从机制上保证这个ip地址不再使用。也就是需要一个无效映射淘汰机制。
6. 无效的ip地址能及时上报到服务器，及时发现问题更新映射文件。
